<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Informe de Ventas</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="container mt-4">
  <h1>Informe de Ventas</h1>

  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>Variedad</th>
        <th>Variedad_Calidad</th>
        <th>TOTAL OFERTA</th>
        <th>TOTAL VENTAS</th>
        <th>TOTAL DISPONIBLE</th>
        <th>Comentarios</th>
      </tr>
    </thead>
    <tbody id="tabla-ventas"></tbody>
  </table>

  <h2 class="mt-4">Ventas por Variedad</h2>
  <canvas id="graficoVariedad"></canvas>

  <h2 class="mt-4">Oferta vs Ventas</h2>
  <canvas id="graficoOfertaVentas"></canvas>

  <script>
    fetch('/api/ventas')
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById('tabla-ventas');
        const variedades = [];
        const ventas = [];
        const ofertas = [];

        data.forEach(item => {
          // llenar tabla
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${item.Variedad}</td>
            <td>${item.Variedad_Calidad}</td>
            <td>${item.TOTAL_OFERTA}</td>
            <td>${item.TOTAL_VENTAS}</td>
            <td>${item.TOTAL_DISPONIBLE}</td>
            <td>${item.Comentarios || ''}</td>
          `;
          tbody.appendChild(row);

          // preparar datos para gráficos
          variedades.push(item.Variedad);
          ventas.push(item.TOTAL_VENTAS);
          ofertas.push(item.TOTAL_OFERTA);
        });

        // gráfico Ventas por Variedad
        new Chart(document.getElementById('graficoVariedad'), {
          type: 'bar',
          data: {
            labels: variedades,
            datasets: [{
              label: 'Ventas',
              data: ventas,
              backgroundColor: 'rgba(54, 162, 235, 0.7)'
            }]
          }
        });

        // gráfico Oferta vs Ventas
        new Chart(document.getElementById('graficoOfertaVentas'), {
          type: 'bar',
          data: {
            labels: variedades,
            datasets: [
              {
                label: 'Oferta',
                data: ofertas,
                backgroundColor: 'rgba(255, 159, 64, 0.7)'
              },
              {
                label: 'Ventas',
                data: ventas,
                backgroundColor: 'rgba(75, 192, 192, 0.7)'
              }
            ]
          }
        });
      })
      .catch(err => console.error('Error cargando datos:', err));
  </script>
</body>
</html>